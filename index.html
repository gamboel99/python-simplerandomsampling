<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simple Random Sampling</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { color: #2c3e50; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; }
    input[type="number"] { width: 100px; margin-right: 10px; }
    button { padding: 8px 16px; cursor: pointer; }
    .footer { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Simple Random Sampling Puskesmas</h1>

  <label>Total Populasi: <input type="number" id="totalPop" value="1061" /></label>
  <label>Jumlah Sampel: <input type="number" id="totalSampel" value="109" /></label>
  <button onclick="generateSampling()">Hitung</button>

  <div id="tabelHasil"></div>

  <script>
    const dataPuskesmas = [
      ["PRAGAAN", 53], ["BLUTO", 37], ["SARONGGI", 27], ["GILI GENTING", 25], ["TALANGO", 27],
      ["KALIANGET", 34], ["PANDIAN", 23], ["PAMOLOKAN", 26], ["BATUAN", 25], ["LENTENG", 36],
      ["MONCEK TENGAH", 21], ["GANDING", 43], ["GULUK-GULUK", 43], ["PASONGSONGAN", 37],
      ["AMBUNTEN", 48], ["RUBARU", 38], ["DASUK", 27], ["MANDING", 35], ["BATU PUTIH", 28],
      ["GAPURA", 36], ["BATANG BATANG", 40], ["LEGUNG TIMUR", 25], ["DUNGKEK", 27],
      ["NONGGUNONG", 22], ["GAYAM", 31], ["RAAS", 17], ["SAPEKEN", 49], ["ARJASA", 108],
      ["KANGAYAN", 54], ["MASALEMBU", 19]
    ];

    function generateSampling() {
      const totalPop = parseInt(document.getElementById("totalPop").value);
      const totalSampel = parseInt(document.getElementById("totalSampel").value);

      // Hitung proporsi dan jumlah sampel per puskesmas
      let hasil = dataPuskesmas.map(([nama, pop], i) => {
        return {
          no: i + 1,
          nama,
          pop,
          proporsi: pop / totalPop,
          sampel: 0,
          responden: []
        };
      });

      // Alokasi awal jumlah sampel
      let alokasi = hasil.map(h => Math.floor(h.proporsi * totalSampel));
      let totalAwal = alokasi.reduce((a, b) => a + b, 0);
      let sisa = totalSampel - totalAwal;

      // Tambahkan sisa berdasarkan proporsi tertinggi
      hasil.forEach((h, i) => h.sampel = alokasi[i]);
      hasil.sort((a, b) => b.proporsi - a.proporsi);
      for (let i = 0; i < sisa; i++) hasil[i].sampel++;

      // Ambil responden acak unik dari 1-109
      let semuaNomor = Array.from({ length: totalSampel }, (_, i) => i + 1);
      shuffleArray(semuaNomor);

      let index = 0;
      hasil.forEach(h => {
        h.responden = semuaNomor.slice(index, index + h.sampel);
        index += h.sampel;
      });

      // Tampilkan tabel
      hasil.sort((a, b) => a.no - b.no);
      let html = `
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Nama Puskesmas</th>
              <th>Jumlah Populasi</th>
              <th>Jumlah Sampel</th>
              <th>Nomor Responden</th>
            </tr>
          </thead>
          <tbody>
      `;

      hasil.forEach(h => {
        html += `
          <tr>
            <td>${h.no}</td>
            <td>${h.nama}</td>
            <td>${h.pop}</td>
            <td>${h.sampel}</td>
            <td>${h.responden.join(", ")}</td>
          </tr>
        `;
      });

      html += `
          </tbody>
          <tfoot>
            <tr>
              <td></td>
              <td><strong>TOTAL</strong></td>
              <td><strong>${hasil.reduce((a, b) => a + b.pop, 0)}</strong></td>
              <td><strong>${hasil.reduce((a, b) => a + b.sampel, 0)}</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      `;

      document.getElementById("tabelHasil").innerHTML = html;
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>
</body>
</html>
